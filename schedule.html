<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="nTessimal, LLC, A nanotech start-up developing tools and processes to manipulate nanoparticles">
    <meta name="keywords" content="nTessimal;semiconductor;carbon;nanotubes;nanoparticles;nanotech;startup;start-up">

    <title>nTessimal - Schedule</title>

    <link rel="shortcut icon" href="favicon.ico" >
    <link rel="stylesheet" type="text/css" href="assets/css/fonts.css" >
    <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css" >
    <link rel="stylesheet" type="text/css" href="assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="assets/fonts/simple-line-icons.css">
    <link rel="stylesheet" type="text/css" href="assets/css/animate.css">
    <link rel="stylesheet" type="text/css" href="assets/css/main.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.css">
</head>

<body>
    <!-- Nav Bar Start -->
    <div id="navbar" class="navbar">
        <nav>
            <div class="navdiv"></div>
        </nav>
    </div>
    <!-- Nav Bar End -->

    <!-- Hero Area Start -->
    <header id="header-wrap">
        <div id="hero-area" class="hero-area-bg2">
            <div class="container">
            <div class="row">
                <div class="col-md-12 col-sm-12 text-center">
                    <div class="contents">
                        <div class="schedule_header">
                            <h1>Let's Talk...</h1>
                            <p>Schedule a Meeting To Learn More</p>
                        </div>
                        <div id="calendar"></div>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </header>
    <!-- Hero Area End -->

    <!-- Footer Section Start -->
    <footer class="footer-area section-padding">
        <div class="container">
        <div class="row">
            <div class="col-md-12">
            <div class="footer-text text-center wow fadeInDown" data-wow-delay="0.3s">
                <div class="footerdiv"></div>
            </div>
            </div>
        </div>
        </div>
    </footer>
    <!-- Footer Section End -->

    <!-- Copyright Section Start -->
    <section class="copyright">
        <p class="copyright">Copyright &copy; 2024 nTessimal, LLC</p>
    </section>
    <!-- Copyright Section End -->

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="assets/js/jquery-min.js"></script>
    <script src="assets/js/popper.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/jquery.mixitup.js"></script>
    <script src="assets/js/wow.js"></script>
    <script src="assets/js/jquery.nav.js"></script>
    <script src="assets/js/jquery.easing.min.js"></script>
    <script src="assets/js/jquery.slicknav.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/iconify-icon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.5/main.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.46/moment-timezone.min.js"></script>

    <script>
        /// @function process_activity_obj
        function process_activity_obj(activity_obj) {
            let i = 0;
        }

        /// @function send_get_request_async
        /// Sends an HTTP GET request and waits for the response.
        function send_get_request_async(url, callback) {
            let xml_http = new XMLHttpRequest();
            let content_type = "application/json; charset=utf-8";

            xml_http.open("GET", url, true);
            xml_http.setRequestHeader('Content-Type', content_type);
            xml_http.onreadystatechange = function() {
                if (xml_http.readyState == XMLHttpRequest.DONE) {
                    callback(xml_http.status, xml_http.responseText);
                }
            }
            xml_http.send();
        }

        /// @function send_get_request_async
        /// Converts an iCal string to a JSON object.
        /// @param {string} ical_str - The iCal formatted string.
        /// @returns {Object} JSON representation of the iCal data.
        function ical_to_json(ical_str) {
            const lines = ical_str.split(/\r?\n/); // Split into lines
            const json = {};

            let currentKey = null;
            let currentEvent = null;
            let isInsideEvent = false;

            json.events = [];

            lines.forEach((line) => {

                // Ignore empty lines
                if (line.trim() === '') return;

                // Detect start of an event
                if (line.startsWith('BEGIN:VEVENT')) {
                    currentEvent = {};
                    isInsideEvent = true;
                    return;
                }

                // Detect end of an event
                if (line.startsWith('END:VEVENT')) {
                    json.events.push(currentEvent);
                    currentEvent = null;
                    isInsideEvent = false;
                    return;
                }

                // Parse general key-value pairs
                const [key, ...valueParts] = line.split(':');
                const value = valueParts.join(':').trim();

                if (isInsideEvent && currentEvent !== null) {

                    // Handle multi-line values (e.g., DESCRIPTION with line breaks)
                    if (key.startsWith(' ')) {
                        currentEvent[currentKey] += value; // Append to the previous key
                    } else {
                        currentKey = key.trim();
                        currentEvent[currentKey] = value;
                    }
                } else {
                    json[key.trim()] = value; // Global properties outside events
                }
            });

            return json;
        }

        /// @function ical_ts_to_fullcal_ts
        function ical_ts_to_fullcal_ts(key, value) {
            let parts = key.split(';');
            var ts = value;

            let subparts = parts[1].split('=');
            if (subparts[0] == "TZID") {
                ts += moment().tz(subparts[1]).format('Z');
            }
            return ts;
        }

        /// @function draw_calendar
        function draw_calendar() {
            var calendarEl = document.getElementById('calendar');

            // Initialize the FullCalendar
            var calendar = new FullCalendar.Calendar(calendarEl, {
                navLinks: true, // can click day/week names to navigate views
                editable: false, // is read-only
                eventSources: [
                    {
                        events: function(fetchInfo, successCallback, failureCallback) {
                            let ical_url = "https://p143-caldav.icloud.com/published/2/MjczNTAwNDU0MjczNTAwNI1RG3j4WlR5e44c1qWDyQ5oPbQkotVfYlOFRRyC28wL5tUX9J4iszK3lY8lpjBK-kHDmvbAg4XzfwB6M0LjHxI";

                            send_get_request_async(ical_url, function (response_code, response_text) {
                                if (response_code == 200) {
                                    let events = ical_to_json(response_text);

                                    successCallback(
                                        events.events.map(function(event) {
                                            var start_time = "";
                                            var end_time = "";

                                            for (const [key, value] of Object.entries(event)) {
                                                if (key.startsWith('DTSTART;')) {
                                                    start_time = ical_ts_to_fullcal_ts(key, value);
                                                }
                                                else if (key.startsWith('DTEND;')) {
                                                    end_time = ical_ts_to_fullcal_ts(key, value);
                                                }
                                            }

                                            return {
                                                title: event['SUMMARY'],
                                                start: start_time,
                                                end: end_time
                                            }
                                        })
                                    );
                                }
                            });
                        },
                    }
                ],
                eventDataTransform: process_activity_obj,
            });

            // Render the calendar
            calendar.render();
        };

        window.onload = function() {
            draw_calendar();
        };
    </script>
</body>
</html>
